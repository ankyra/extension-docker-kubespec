machine:
  services:
  - docker
  environment:
    ESCAPE_PROJECT: "_"
    ESCAPE_STORAGE_BACKEND: "escape"
    ESCAPE_API_SERVER: "https://registry.ankyra.io"

dependencies:
  pre:
  - pip install PyYAML==3.12
  - curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.6.4/bin/linux/amd64/kubectl
  - mv kubectl /home/ubuntu/bin
  - chmod +x /home/ubuntu/bin/kubectl

  - curl https://storage.googleapis.com/escape-releases-eu/escape-v0.10.17.tgz > escape.tgz
  - rm -rf escape && tar -xvzf escape.tgz
  - mv escape /home/ubuntu/bin
  - escape version
  - "escape state create --deploy -v kubernetes_kubectl='{\"project_id\": \"lol\"}:' kubernetes-provider-latest"
  - escape deploy kubernetes-provider-latest -d '_/kubernetes-provider'

compile:
  override:
  - escape state create -v docker_image=test
  - escape state create --deploy -v docker_image=test
  - echo "from alpine" > Dockerfile
  - escape release

test:
  override:
  - echo "Already tested"

